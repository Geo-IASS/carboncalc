# -*- coding: utf-8 -*-
"""
Created on Tue Jun  3 13:18:57 2014

@author: adh

Pytest-based testing framework for biomass and growth calculator.
"""

import growth, biomass

import pytest

from numpy.testing import assert_allclose

#rtol0 = 1e-2
rtol0 = 0.1

regiondict = {'CenFla': 'Central Florida', 'GulfCo': 'Coastal Plain', 'InlEmp': 'Inland Empire',
              'InlVal': 'Inland Valleys', 'InterW': 'Interior West', 'LoMidW': 'Lower Midwest',
              'MidWst': 'Midwest', 'NoCalC': 'Northern California Coast', 'NMtnPr': 'North',
              'NoEast': 'Northeast', 'PacfNW': 'Pacific Northwest', 'Piedmt': 'South',
              'SoCalC': 'Southern California Coast', 'SWDsrt': 'Southwest Desert',
              'TpIntW': 'Temperate Interior West', 'Tropic': 'Tropical'}
              
regioninvdict = dict((v,k) for k, v in regiondict.iteritems())


"""
@pytest.mark.parametrize(("input","expected","rtol"), [
    (('ACRU', 'ACRU', 10, 4), (30.744, 19.708, 72.328), rtol0),
    (('ACRU', 'ACRU', 10, 4), (3.744, 19.708, 72.328), rtol0),
])
def test_eq_dw12(input, expected, rtol):
    assert_allclose(biomass.equation_dw12(biomass.dbconn, input[0], input[1], input[2], input[3]), expected, rtol=rtol)
"""   

"""
@pytest.mark.parametrize(("input","expected","rtol"), [
    (("dw12", 'ACRU', 'ACRU', 10, 4), (30.744, 19.708, 72.328), rtol0),
])
def test_biomass_eqns(input, expected, rtol):
    eqn = biomass.eqn_lookup[input[0]]
    assert_allclose(eqn(biomass.dbconn, input[1], input[2], input[3], input[4]), expected, rtol=rtol)
"""

@pytest.mark.parametrize(("input","expected","rtol", "dataid"), [
    (('ACRU','CenFla',2.335461,2.840114), (1.265954, 0.811509, 2.978239), rtol0, 1),
(('ACRU','CenFla',67.028712,14.901616), (1995.281648, 1279.026697, 4694.027980), rtol0, 31),
(('ACRU','CenFla',96.606282,16.027995), (4448.140514, 2851.372125, 10464.535700), rtol0, 66),
(('ERJA','CenFla',1.726091,1.631344), (0.410798, 0.263332, 0.966428), rtol0, 163),
(('ERJA','CenFla',37.157464,7.898220), (468.185353, 300.118816, 1101.436056), rtol0, 183),
(('ERJA','CenFla',54.873150,8.540814), (1055.500133, 676.602649, 2483.131723), rtol0, 193),
(('JUSI','CenFla',1.036488,2.201784), (0.045347, 0.029068, 0.106681), rtol0, 194),
(('JUSI','CenFla',36.085642,9.039443), (479.507062, 307.376322, 1128.071101), rtol0, 214),
(('JUSI','CenFla',80.528212,12.095075), (2992.574272, 1918.316841, 7040.222807), rtol0, 238),
(('SYRO','CenFla',0.000000,0.393486), (4.375707, 2.804940, 10.294131), rtol0, 836),
(('SYRO','CenFla',0.000000,11.008406), (76.557163, 49.075104, 180.105633), rtol0, 856),
(('SYRO','CenFla',0.000000,13.574620), (94.007414, 60.261163, 221.158468), rtol0, 863),
(('ULPA','CenFla',0.644570,1.986099), (0.022475, 0.014407, 0.052875), rtol0, 936),
(('ULPA','CenFla',29.272023,9.385768), (344.324863, 220.721066, 810.046313), rtol0, 956),
(('ULPA','CenFla',59.979631,12.409736), (2094.514274, 1342.637355, 4927.479094), rtol0, 986),
(('ULPA','CenFla',76.970854,12.432328), (3743.709622, 2399.813860, 8807.316868), rtol0, 1006),
(('ACRU','GulfCo',2.529440,2.631951), (1.508064, 0.966708, 3.547817), rtol0, 1037),
(('ACRU','GulfCo',38.220529,14.145995), (581.992737, 373.072268, 1369.175222), rtol0, 1057),
(('ACRU','GulfCo',70.342509,16.773344), (2218.038832, 1421.819764, 5218.078534), rtol0, 1075),
(('CELA','GulfCo',3.038739,2.641647), (7.502036, 4.808997, 17.649021), rtol0, 1198),
(('CELA','GulfCo',37.663904,10.933001), (822.064293, 526.964290, 1933.958945), rtol0, 1218),
(('CELA','GulfCo',64.736047,12.009723), (2482.382906, 1591.271094, 5839.964914), rtol0, 1239),
(('JUVI','GulfCo',2.532284,1.110761), (0.786996, 0.504484, 1.851458), rtol0, 1376),
(('JUVI','GulfCo',23.216842,7.963616), (173.785489, 111.400954, 408.841502), rtol0, 1396),
(('JUVI','GulfCo',84.300817,13.137797), (3320.535617, 2128.548472, 7811.772893), rtol0, 1431),
(('QUVI','GulfCo',0.944638,0.663236), (0.035197, 0.022562, 0.082804), rtol0, 2208),
(('QUVI','GulfCo',41.528161,10.673163), (919.442844, 589.386438, 2163.048228), rtol0, 2228),
(('QUVI','GulfCo',86.038186,14.164601), (5404.441131, 3464.385340, 12714.294200), rtol0, 2258),
(('QUVI','GulfCo',114.541944,15.648539), (10745.067990, 6887.864095, 25278.461230), rtol0, 2297),
(('SAPA','GulfCo',0.000000,0.075017), (2.210117, 1.416741, 5.199441), rtol0, 2298),
(('SAPA','GulfCo',0.000000,6.170151), (43.657026, 27.985273, 102.705952), rtol0, 2318),
(('SAPA','GulfCo',0.000000,12.566891), (87.154858, 55.868499, 205.037390), rtol0, 2343),
(('FRUH','InlEmp',1.294176,0.311617), (0.160067, 0.102607, 0.376567), rtol0, 2602),
(('FRUH','InlEmp',46.614376,15.570709), (1501.612785, 962.572298, 3532.640333), rtol0, 2622),
(('FRUH','InlEmp',87.542997,22.777123), (6148.904261, 3941.605295, 14465.691430), rtol0, 2652),
(('FRUH','InlEmp',118.037479,26.817686), (11867.287920, 7607.235845, 27918.555550), rtol0, 2692),
(('LITU','InlEmp',1.977042,3.519398), (1.772822, 1.136424, 4.170676), rtol0, 3078),
(('LITU','InlEmp',30.903142,12.540529), (430.086133, 275.696239, 1011.805197), rtol0, 3098),
(('LITU','InlEmp',54.853100,17.641602), (2062.919116, 1322.384049, 4853.149459), rtol0, 3128),
(('LITU','InlEmp',83.056354,20.897982), (6408.937728, 4108.293415, 15077.436830), rtol0, 3143),
(('PHDA4','InlEmp',0.000000,0.265530), (3.505603, 2.247182, 8.247157), rtol0, 3314),
(('PHDA4','InlEmp',0.000000,7.130000), (50.184000, 32.169231, 118.061077), rtol0, 3334),
(('PHDA4','InlEmp',0.000000,18.605000), (128.214000, 82.188462, 301.631654), rtol0, 3364),
(('PHDA4','InlEmp',0.000000,20.547600), (141.423680, 90.656205, 332.708273), rtol0, 3374),
(('PIBR2','InlEmp',4.120980,3.112590), (0.917587, 0.588197, 2.158682), rtol0, 3375),
(('PIBR2','InlEmp',53.609388,11.875958), (692.283958, 443.771768, 1628.642389), rtol0, 3395),
(('PIBR2','InlEmp',55.735456,11.964935), (759.076588, 486.587557, 1785.776333), rtol0, 3400),
(('FRPE_M','InlVal',2.522745,1.988909), (1.889912, 1.211482, 4.446138), rtol0, 4585),
(('FRPE_M','InlVal',29.764679,9.862210), (507.352366, 325.225875, 1193.578963), rtol0, 4605),
(('FRPE_M','InlVal',43.491826,11.765379), (1145.582980, 734.348064, 2695.057395), rtol0, 4633),
(('FRVE_G','InlVal',2.520593,2.000184), (0.269638, 0.172845, 0.634341), rtol0, 4634),
(('FRVE_G','InlVal',36.149469,10.867202), (330.624568, 211.938826, 777.815491), rtol0, 4654),
(('FRVE_G','InlVal',67.137307,19.037851), (2192.817441, 1405.652206, 5158.743596), rtol0, 4684),
(('FRVE_G','InlVal',75.126318,21.144336), (3105.697308, 1990.831608, 7306.352000), rtol0, 4709),
(('PHDA4','InlVal',0.000000,0.265530), (3.505603, 2.247182, 8.247157), rtol0, 5212),
(('PHDA4','InlVal',0.000000,7.130000), (50.184000, 32.169231, 118.061077), rtol0, 5232),
(('PHDA4','InlVal',0.000000,18.605000), (128.214000, 82.188462, 301.631654), rtol0, 5262),
(('PHDA4','InlVal',0.000000,20.547600), (141.423680, 90.656205, 332.708273), rtol0, 5272),
(('CHLI','InterW',4.297047,2.843370), (4.348212, 2.787315, 10.229447), rtol0, 5970),
(('CHLI','InterW',22.892089,5.519013), (150.760334, 96.641240, 354.673351), rtol0, 5990),
(('CHLI','InterW',41.487132,10.712466), (608.833533, 390.277905, 1432.319913), rtol0, 6010),
(('EUMI2','InterW',2.558965,2.679927), (0.543586, 0.348452, 1.278820), rtol0, 6186),
(('EUMI2','InterW',39.256208,13.953052), (768.829366, 492.839337, 1808.720368), rtol0, 6206),
(('EUMI2','InterW',85.127762,23.391038), (6262.003295, 4014.104677, 14731.764160), rtol0, 6231),
(('FRAM','InterW',2.442177,3.948046), (0.790000, 0.503446, 1.847648), rtol0, 6232),
(('FRAM','InterW',30.870640,9.490035), (525.160000, 336.641006, 1235.472493), rtol0, 6252),
(('FRAM','InterW',75.757686,18.240544), (4865.570000, 3118.956830, 11446.571570), rtol0, 6282),
(('FRAM','InterW',75.757686,18.240544), (4865.570000, 3118.956830, 11446.571570), rtol0, 6292),
(('GLTR','InterW',2.716725,3.104259), (2.900000, 1.860282, 6.827235), rtol0, 6475),
(('GLTR','InterW',24.950490,7.898610), (374.530000, 240.082395, 881.102389), rtol0, 6495),
(('GLTR','InterW',58.301139,15.090138), (2507.600000, 1607.434886, 5899.286032), rtol0, 6525),
(('GLTR','InterW',66.082957,16.768161), (3324.820000, 2131.293123, 7821.845762), rtol0, 6532),
(('WARO','InterW',0.000000,0.760760), (6.873168, 4.405877, 16.169568), rtol0, 7501),
(('WARO','InterW',0.000000,13.224000), (91.623200, 58.732821, 215.549451), rtol0, 7521),
(('WARO','InterW',0.000000,25.200000), (173.060000, 110.935897, 407.134744), rtol0, 7551),
(('WARO','InterW',0.000000,27.971160), (191.903888, 123.015313, 451.466198), rtol0, 7572),
(('ACRU','LoMidW',1.176693,2.923985), (0.281483, 0.180438, 0.662206), rtol0, 7659),
(('ACRU','LoMidW',26.210135,10.723411), (254.445540, 163.106115, 598.599444), rtol0, 7679),
(('ACRU','LoMidW',56.230192,17.984690), (1357.295720, 870.061359, 3193.125187), rtol0, 7709),
(('ACRU','LoMidW',80.395785,22.172587), (2973.133299, 1905.854679, 6994.486672), rtol0, 7759),
(('ACRU','LoMidW',81.348728,22.307436), (3050.974418, 1955.752832, 7177.612894), rtol0, 7769),
(('MAGR','LoMidW',3.060798,1.605294), (0.350000, 0.224745, 0.824816), rtol0, 8811),
(('MAGR','LoMidW',27.941372,10.546027), (167.720000, 107.515602, 394.582260), rtol0, 8831),
(('MAGR','LoMidW',79.598063,18.737210), (2382.320000, 1527.130298, 5604.568193), rtol0, 8861),
(('MAGR','LoMidW',83.653505,18.787590), (2646.490000, 1696.465651, 6226.028938), rtol0, 8866),
(('PHDA4','LoMidW',0.000000,0.265530), (3.505603, 2.247182, 8.247157), rtol0, 9085),
(('PHDA4','LoMidW',0.000000,7.130000), (50.184000, 32.169231, 118.061077), rtol0, 9105),
(('PHDA4','LoMidW',0.000000,18.605000), (128.214000, 82.188462, 301.631654), rtol0, 9135),
(('PHDA4','LoMidW',0.000000,20.547600), (141.423680, 90.656205, 332.708273), rtol0, 9145),
(('QURU','LoMidW',1.501953,4.561136), (1.620000, 1.039908, 3.816464), rtol0, 9560),
(('QURU','LoMidW',30.762895,11.531834), (512.200000, 328.334827, 1204.988813), rtol0, 9580),
(('QURU','LoMidW',76.964383,20.713367), (4876.050000, 3125.672670, 11471.218700), rtol0, 9610),
(('QURU','LoMidW',130.866119,28.601013), (17969.910000, 11519.172120, 42275.361670), rtol0, 9645),
(('ULPU','LoMidW',3.767688,5.499016), (18.390000, 11.787430, 43.259867), rtol0, 9757),
(('ULPU','LoMidW',38.589456,13.764282), (874.390000, 560.505734, 2057.056044), rtol0, 9777),
(('ULPU','LoMidW',79.570279,19.610818), (3343.520000, 2143.281089, 7865.841595), rtol0, 9807),
(('ULPU','LoMidW',117.866775,21.285262), (5530.020000, 3544.885815, 13009.730940), rtol0, 9857),
(('ULPU','LoMidW',122.683667,21.285262), (5722.690000, 3668.388079, 13462.984250), rtol0, 9877),
(('ACRU','MidWst',4.121642,2.976393), (4.400477, 2.820819, 10.352405), rtol0, 10042),
(('ACRU','MidWst',26.811426,11.501642), (267.423955, 171.425612, 629.131998), rtol0, 10062),
(('ACRU','MidWst',63.030646,17.621169), (1743.504594, 1117.631150, 4101.706322), rtol0, 10072),
(('QUNI','MidWst',4.519772,2.536725), (1.481793, 0.949867, 3.486013), rtol0, 10706),
(('QUNI','MidWst',37.731472,14.359711), (601.504356, 385.579715, 1415.077555), rtol0, 10726),
(('QUNI','MidWst',93.440976,23.650993), (6733.918195, 4316.614228, 15841.974220), rtol0, 10756),
(('QUNI','MidWst',112.170984,25.860324), (10878.321150, 6973.282790, 25591.947840), rtol0, 10777),
(('QURU','MidWst',1.993741,3.397555), (0.520426, 0.333606, 1.224335), rtol0, 10817),
(('QURU','MidWst',31.465349,12.894021), (541.416171, 347.061648, 1273.716248), rtol0, 10837),
(('QURU','MidWst',63.230390,17.075539), (3008.222990, 1928.348070, 7077.037418), rtol0, 10867),
(('QURU','MidWst',68.493850,17.161840), (3661.328356, 2347.005357, 8613.509659), rtol0, 10886),
(('FRAM','NMtnPr',2.842198,2.631455), (1.260000, 0.807438, 2.963298), rtol0, 11551),
(('FRAM','NMtnPr',28.030549,12.705958), (413.370000, 264.982586, 972.486092), rtol0, 11571),
(('FRAM','NMtnPr',72.381090,19.321112), (4345.400000, 2785.510140, 10222.822210), rtol0, 11601),
(('FRAM','NMtnPr',80.307751,20.123623), (5622.750000, 3604.329470, 13227.889150), rtol0, 11615),
(('MAGR','NMtnPr',3.060798,1.605294), (0.350000, 0.224745, 0.824816), rtol0, 12018),
(('MAGR','NMtnPr',27.941372,10.546027), (167.720000, 107.515602, 394.582260), rtol0, 12038),
(('MAGR','NMtnPr',83.653505,18.787590), (2646.490000, 1696.465651, 6226.028938), rtol0, 12070),
(('PICO5','NMtnPr',2.611644,2.160485), (0.230000, 0.147372, 0.540854), rtol0, 12071),
(('PICO5','NMtnPr',32.059927,8.966780), (160.840000, 103.101468, 378.382386), rtol0, 12091),
(('PICO5','NMtnPr',43.455353,11.600571), (376.160000, 241.127777, 884.938941), rtol0, 12108),
(('ACRU','NoEast',2.641658,3.871285), (1.658701, 1.063270, 3.902201), rtol0, 13187),
(('ACRU','NoEast',21.975879,8.382957), (172.884849, 110.823621, 406.722689), rtol0, 13207),
(('ACRU','NoEast',37.087139,11.569658), (544.808342, 349.236117, 1281.696548), rtol0, 13237),
(('ACRU','NoEast',72.771931,17.912548), (2389.525362, 1531.747027, 5621.511589), rtol0, 13287),
(('ACRU','NoEast',105.198593,22.235602), (5362.170384, 3437.288708, 12614.849560), rtol0, 13306),
(('FRPE','NoEast',2.417639,1.560735), (1.493794, 0.957560, 3.514247), rtol0, 13712),
(('FRPE','NoEast',24.765732,10.691435), (380.606842, 243.978745, 895.401994), rtol0, 13732),
(('FRPE','NoEast',44.606945,14.753367), (1389.396749, 890.638942, 3268.644915), rtol0, 13762),
(('FRPE','NoEast',106.307518,22.062210), (8960.601243, 5743.975156, 21080.388820), rtol0, 13812),
(('FRPE','NoEast',123.452416,23.477341), (12294.621230, 7881.167457, 28923.884570), rtol0, 13819),
(('JUVI','NoEast',3.336559,1.261638), (1.630000, 1.046101, 3.839192), rtol0, 14137),
(('JUVI','NoEast',33.082409,12.612634), (392.840000, 251.821193, 924.183779), rtol0, 14157),
(('JUVI','NoEast',69.903054,17.906746), (2169.470000, 1390.685921, 5103.817331), rtol0, 14187),
(('JUVI','NoEast',85.952514,23.962760), (3470.110000, 2224.430415, 8163.659622), rtol0, 14204),
(('SAPA','NoEast',0.000000,0.113154), (2.469450, 1.582981, 5.809539), rtol0, 15279),
(('SAPA','NoEast',0.000000,6.145750), (43.491099, 27.878910, 102.315599), rtol0, 15299),
(('SAPA','NoEast',0.000000,7.800818), (54.745566, 35.093311, 128.792452), rtol0, 15321),
(('ULPA99','NoEast',2.771588,3.609792), (0.948859, 0.608243, 2.232251), rtol0, 15718),
(('ULPA99','NoEast',21.435929,9.534459), (178.082195, 114.155253, 418.949779), rtol0, 15738),
(('ULPA99','NoEast',48.791896,13.691404), (1440.647592, 923.492046, 3389.215810), rtol0, 15762),
(('LITU','NoCalC',2.841073,3.960871), (0.560000, 0.357971, 1.313752), rtol0, 16460),
(('LITU','NoCalC',20.714500,9.413979), (144.140000, 92.397784, 339.099868), rtol0, 16480),
(('LITU','NoCalC',47.524639,15.273803), (1394.110000, 893.662516, 3279.741433), rtol0, 16510),
(('LITU','NoCalC',84.165163,18.780197), (6645.430000, 4259.890571, 15633.798390), rtol0, 16551),
(('PIRA','NoCalC',2.805513,1.453239), (0.213941, 0.137141, 0.503309), rtol0, 16905),
(('PIRA','NoCalC',34.869016,12.094076), (241.548369, 154.838698, 568.258021), rtol0, 16925),
(('PIRA','NoCalC',82.964270,21.215003), (2424.211473, 1553.981713, 5703.112888), rtol0, 16955),
(('PIRA','NoCalC',115.027772,22.747530), (5258.295506, 3370.702247, 12370.477250), rtol0, 16975),
(('PYCA','NoCalC',0.551853,0.858170), (0.033407, 0.021414, 0.078591), rtol0, 17104),
(('PYCA','NoCalC',23.294165,9.258778), (241.313637, 154.688229, 567.705799), rtol0, 17124),
(('PYCA','NoCalC',57.407633,12.435001), (1707.074431, 1094.278481, 4016.002027), rtol0, 17154),
(('WARO','NoCalC',0.000000,0.620643), (5.920372, 3.795111, 13.928056), rtol0, 17566),
(('WARO','NoCalC',0.000000,14.796816), (102.318349, 65.588685, 240.710474), rtol0, 17586),
(('WARO','NoCalC',0.000000,28.492875), (195.451550, 125.289455, 459.812300), rtol0, 17616),
(('WARO','NoCalC',0.000000,30.526200), (209.278162, 134.152668, 492.340291), rtol0, 17637),
(('ACRU','PacfNW',1.324801,2.751411), (0.365073, 0.234021, 0.858857), rtol0, 17884),
(('ACRU','PacfNW',31.965046,12.423359), (393.251713, 252.084431, 925.149864), rtol0, 17904),
(('ACRU','PacfNW',80.344379,19.235423), (2968.965313, 1903.182893, 6984.681217), rtol0, 17934),
(('ACRU','PacfNW',96.470824,27.546689), (4434.472284, 2842.610438, 10432.380310), rtol0, 17944),
(('PSME','PacfNW',1.152304,0.703725), (1.779073, 1.140432, 4.185384), rtol0, 18778),
(('PSME','PacfNW',40.971466,19.106857), (936.305773, 600.196008, 2202.719350), rtol0, 18798),
(('PSME','PacfNW',85.216325,29.363202), (5605.022572, 3592.963187, 13186.174900), rtol0, 18828),
(('PSME','PacfNW',108.857273,30.478423), (10195.492450, 6535.572082, 23985.549540), rtol0, 18871),
(('QUAG','PacfNW',1.557324,2.505330), (0.130832, 0.083867, 0.307790), rtol0, 18971),
(('QUAG','PacfNW',31.295493,9.434010), (315.805730, 202.439571, 742.953225), rtol0, 18991),
(('QUAG','PacfNW',75.902746,13.506925), (3085.988155, 1978.197535, 7259.984954), rtol0, 19021),
(('QUAG','PacfNW',150.248168,20.462946), (19501.923070, 12501.232740, 45879.524150), rtol0, 19071),
(('QURU','PacfNW',1.987888,4.384578), (0.546768, 0.350492, 1.286306), rtol0, 19072),
(('QURU','PacfNW',42.037288,12.883643), (1103.222477, 707.193895, 2595.401596), rtol0, 19092),
(('QURU','PacfNW',97.309129,27.580379), (8676.975817, 5562.163985, 20413.141830), rtol0, 19122),
(('QURU','PacfNW',105.867967,27.998097), (10674.046980, 6842.337806, 25111.379750), rtol0, 19136),
(('TIAM','PacfNW',1.118585,2.501098), (0.622554, 0.399073, 1.464597), rtol0, 19137),
(('TIAM','PacfNW',33.719246,11.507367), (377.690533, 242.109316, 888.541189), rtol0, 19157),
(('TIAM','PacfNW',75.100736,20.480841), (1937.285574, 1241.849727, 4557.588498), rtol0, 19187),
(('TIAM','PacfNW',84.852615,22.195065), (2474.712503, 1586.354168, 5821.919798), rtol0, 19207),
(('WARO','PacfNW',0.000000,0.620643), (5.920372, 3.795111, 13.928056), rtol0, 19402),
(('WARO','PacfNW',0.000000,14.796816), (102.318349, 65.588685, 240.710474), rtol0, 19422),
(('WARO','PacfNW',0.000000,28.492875), (195.451550, 125.289455, 459.812300), rtol0, 19452),
(('WARO','PacfNW',0.000000,30.526200), (209.278162, 134.152668, 492.340291), rtol0, 19473),
(('ACRU','Piedmt',4.187715,4.000092), (4.556682, 2.920950, 10.719887), rtol0, 19474),
(('ACRU','Piedmt',35.334337,13.311435), (489.921616, 314.052318, 1152.572007), rtol0, 19494),
(('ACRU','Piedmt',103.038301,26.290365), (5123.612197, 3284.366793, 12053.626130), rtol0, 19524),
(('ACRU','Piedmt',122.459135,26.290365), (7482.682165, 4796.591132, 17603.489450), rtol0, 19531),
(('COFL','Piedmt',1.442711,2.155595), (0.428722, 0.274821, 1.008595), rtol0, 19686),
(('COFL','Piedmt',33.694364,7.817193), (472.811200, 303.084103, 1112.318657), rtol0, 19706),
(('COFL','Piedmt',51.611949,8.814804), (1177.080062, 754.538501, 2769.156299), rtol0, 19716),
(('QUAL','Piedmt',1.329137,1.881604), (0.118995, 0.076279, 0.279944), rtol0, 20320),
(('QUAL','Piedmt',35.843757,17.999803), (741.366433, 475.234893, 1744.112057), rtol0, 20340),
(('QUAL','Piedmt',90.340526,32.214163), (8280.911144, 5308.276374, 19481.374290), rtol0, 20370),
(('QUAL','Piedmt',123.038587,34.169798), (16772.795740, 10751.792140, 39459.077170), rtol0, 20388),
(('QURU','Piedmt',3.869682,5.249751), (3.089564, 1.980490, 7.268398), rtol0, 20533),
(('QURU','Piedmt',38.642981,16.991875), (897.050364, 575.032284, 2110.368484), rtol0, 20553),
(('QURU','Piedmt',96.018925,30.225512), (8397.008806, 5382.697952, 19754.501490), rtol0, 20586),
(('WAFI','Piedmt',0.000000,0.365377), (4.184562, 2.682412, 9.844451), rtol0, 20670),
(('WAFI','Piedmt',0.000000,7.001040), (49.307072, 31.607097, 115.998048), rtol0, 20690),
(('WAFI','Piedmt',0.000000,15.618750), (107.907500, 69.171474, 253.859311), rtol0, 20720),
(('WAFI','Piedmt',0.000000,21.311220), (146.616296, 93.984805, 344.924234), rtol0, 20761),
(('FIMI','SoCalC',2.503877,1.491101), (0.402265, 0.257862, 0.946355), rtol0, 21215),
(('FIMI','SoCalC',38.127507,7.781696), (268.147603, 171.889489, 630.834424), rtol0, 21235),
(('FIMI','SoCalC',79.945102,11.803796), (1524.781788, 977.424223, 3587.146899), rtol0, 21266),
(('JAMI','SoCalC',2.677914,3.216587), (0.640870, 0.410814, 1.507687), rtol0, 21267),
(('JAMI','SoCalC',18.312622,5.740785), (58.839676, 37.717741, 138.424110), rtol0, 21287),
(('JAMI','SoCalC',41.764684,9.527081), (470.837887, 301.819158, 1107.676311), rtol0, 21317),
(('JAMI','SoCalC',61.308069,12.682328), (1274.523949, 817.002531, 2998.399290), rtol0, 21342),
(('MEEX','SoCalC',2.522726,1.242857), (1.030386, 0.660504, 2.424049), rtol0, 21503),
(('MEEX','SoCalC',25.235997,7.526786), (105.512090, 67.635955, 248.223957), rtol0, 21523),
(('MEEX','SoCalC',69.559930,12.464845), (809.809683, 519.108771, 1905.129191), rtol0, 21553),
(('MEEX','SoCalC',85.159704,13.612529), (1216.218825, 779.627452, 2861.232748), rtol0, 21558),
(('PRCA','SoCalC',2.526682,1.992632), (1.062994, 0.681406, 2.500761), rtol0, 22096),
(('PRCA','SoCalC',22.774535,5.825533), (158.429149, 101.557147, 372.714729), rtol0, 22116),
(('PRCA','SoCalC',30.238718,6.442458), (294.559960, 188.820487, 692.971188), rtol0, 22136),
(('WARO','SoCalC',0.000000,0.620643), (5.920372, 3.795111, 13.928056), rtol0, 22236),
(('WARO','SoCalC',0.000000,14.796816), (102.318349, 65.588685, 240.710474), rtol0, 22256),
(('WARO','SoCalC',0.000000,28.492875), (195.451550, 125.289455, 459.812300), rtol0, 22286),
(('WARO','SoCalC',0.000000,30.526200), (209.278162, 134.152668, 492.340291), rtol0, 22307),
(('OLEU','SWDsrt',2.525279,1.072480), (0.879549, 0.563813, 2.069195), rtol0, 22799),
(('OLEU','SWDsrt',28.659578,6.768037), (342.641957, 219.642280, 806.087167), rtol0, 22819),
(('OLEU','SWDsrt',55.541297,9.372113), (1547.415944, 991.933297, 3640.395202), rtol0, 22849),
(('OLEU','SWDsrt',68.386759,10.280516), (2469.771225, 1583.186683, 5810.295125), rtol0, 22889),
(('PICH','SWDsrt',2.547395,2.675224), (0.442575, 0.283702, 1.041186), rtol0, 23120),
(('PICH','SWDsrt',22.940852,7.424473), (143.285953, 91.849970, 337.089389), rtol0, 23140),
(('PICH','SWDsrt',53.531037,12.316011), (1479.502565, 948.399080, 3480.624625), rtol0, 23170),
(('PICH','SWDsrt',63.727765,13.351234), (2339.618012, 1499.755136, 5504.101350), rtol0, 23180),
(('PRCH','SWDsrt',2.522919,1.532896), (1.624744, 1.041502, 3.822313), rtol0, 23332),
(('PRCH','SWDsrt',36.706832,10.169386), (616.594807, 395.253082, 1450.578809), rtol0, 23352),
(('PRCH','SWDsrt',70.890744,13.938985), (2531.505826, 1622.760145, 5955.529732), rtol0, 23372),
(('ACSA2','TpIntW',3.577912,3.856246), (9.698027, 6.216684, 22.815230), rtol0, 23855),
(('ACSA2','TpIntW',22.394933,9.245268), (286.581214, 183.705907, 674.200677), rtol0, 23875),
(('ACSA2','TpIntW',56.404893,18.985408), (1894.739487, 1214.576594, 4457.496101), rtol0, 23905),
(('ACSA2','TpIntW',76.424408,24.718813), (3589.821966, 2301.167927, 8445.286293), rtol0, 23939),
(('FRAM','TpIntW',2.119924,3.999206), (0.611592, 0.392046, 1.438808), rtol0, 24127),
(('FRAM','TpIntW',33.232541,12.418070), (630.504051, 404.169264, 1483.301198), rtol0, 24147),
(('FRAM','TpIntW',60.528025,18.704863), (2788.851604, 1787.725387, 6560.952170), rtol0, 24177),
(('FRAM','TpIntW',105.578938,26.834033), (11081.521676, 7103.539536, 26069.990100), rtol0, 24225),
(('LIST','TpIntW',2.800413,1.583472), (0.381221, 0.244373, 0.896847), rtol0, 24609),
(('LIST','TpIntW',26.055290,12.923731), (159.766688, 102.414543, 375.861374), rtol0, 24629),
(('LIST','TpIntW',53.832476,20.302874), (1034.815572, 663.343316, 2434.469968), rtol0, 24659),
(('LIST','TpIntW',68.890828,23.283308), (1939.349891, 1243.173007, 4562.444936), rtol0, 24694),
(('CAEQ','Tropic',2.440925,3.133434), (1.222602, 0.783719, 2.876249), rtol0, 25648),
(('CAEQ','Tropic',22.241471,9.556731), (194.490016, 124.673087, 457.550230), rtol0, 25668),
(('CAEQ','Tropic',51.942291,17.026762), (1561.284277, 1000.823254, 3673.021343), rtol0, 25698),
(('CAEQ','Tropic',101.443657,23.703705), (7205.531956, 4618.930741, 16951.475820), rtol0, 25748),
(('CAEQ','Tropic',116.294067,24.299593), (9467.613067, 6068.982735, 22273.166640), rtol0, 25763),
(('CONU','Tropic',0.000000,1.569590), (12.373212, 7.931546, 29.108774), rtol0, 26045),
(('CONU','Tropic',0.000000,12.824272), (88.905049, 56.990416, 209.154827), rtol0, 26065),
(('CONU','Tropic',0.000000,23.858777), (163.939683, 105.089540, 385.678613), rtol0, 26095),
(('CONU','Tropic',0.000000,25.015651), (171.806424, 110.132323, 404.185627), rtol0, 26100),
(('MEQU','Tropic',2.356344,1.987466), (0.898340, 0.575859, 2.113403), rtol0, 26615),
(('MEQU','Tropic',31.018065,7.797275), (159.730061, 102.391065, 375.775207), rtol0, 26635),
(('MEQU','Tropic',81.176078,10.777461), (1104.565583, 708.054861, 2598.561340), rtol0, 26670),
(('PIBR2','Tropic',4.120980,3.112590), (0.917587, 0.588197, 2.158682), rtol0, 26732),
(('PIBR2','Tropic',53.609388,11.875958), (692.283958, 443.771768, 1628.642389), rtol0, 26752),
(('PIBR2','Tropic',55.735456,11.964935), (759.076588, 486.587557, 1785.776333), rtol0, 26757),
(('PIRA','Tropic',2.805513,1.453239), (0.213941, 0.137141, 0.503309), rtol0, 26796),
(('PIRA','Tropic',34.869016,12.094076), (241.548369, 154.838698, 568.258021), rtol0, 26816),
(('PIRA','Tropic',82.964270,21.215003), (2424.211473, 1553.981713, 5703.112888), rtol0, 26846),
(('PIRA','Tropic',115.027772,22.747530), (5258.295506, 3370.702247, 12370.477250), rtol0, 26866),
])    
def test_biomass_calc(input, expected, rtol, dataid):
    (speccode, region, dbh, ht) = input
    assert_allclose(biomass.biomass_calc(biomass.dbconn, speccode, region, dbh, ht, useminmax=True, negcorrect=True), expected, rtol=rtol)

 
"""
@pytest.mark.parametrize(("input","expected","rtol", "dataid"), [ 
(('ACRU','CenFla',2.335461,2.840114), (2.978239), rtol0, 1),
(('ACRU','CenFla',67.028712,14.901616), (254.554709), rtol0, 31),
(('ACRU','CenFla',96.606282,16.027995), (12.877997), rtol0, 66),
(('ERJA','CenFla',1.726091,1.631344), (0.966428), rtol0, 163),
(('ERJA','CenFla',37.157464,7.898220), (113.252217), rtol0, 183),
(('ERJA','CenFla',54.873150,8.540814), (154.069475), rtol0, 193),
(('JUSI','CenFla',1.036488,2.201784), (0.106681), rtol0, 194),
(('JUSI','CenFla',36.085642,9.039443), (134.748963), rtol0, 214),
(('JUSI','CenFla',80.528212,12.095075), (322.042115), rtol0, 238),
(('SYRO','CenFla',0.000000,0.393486), (10.294131), rtol0, 836),
(('SYRO','CenFla',0.000000,11.008406), (6.472729), rtol0, 856),
(('SYRO','CenFla',0.000000,13.574620), (5.465556), rtol0, 863),
(('ULPA','CenFla',0.644570,1.986099), (0.052875), rtol0, 936),
(('ULPA','CenFla',29.272023,9.385768), (86.582239), rtol0, 956),
(('ULPA','CenFla',59.979631,12.409736), (172.443292), rtol0, 986),
(('ULPA','CenFla',76.970854,12.432328), (215.763911), rtol0, 1006),
(('ACRU','GulfCo',2.529440,2.631951), (3.547817), rtol0, 1037),
(('ACRU','GulfCo',38.220529,14.145995), (136.319379), rtol0, 1057),
(('ACRU','GulfCo',70.342509,16.773344), (285.961464), rtol0, 1075),
(('CELA','GulfCo',3.038739,2.641647), (17.649021), rtol0, 1198),
(('CELA','GulfCo',37.663904,10.933001), (203.015847), rtol0, 1218),
(('CELA','GulfCo',64.736047,12.009723), (13.943330), rtol0, 1239),
(('JUVI','GulfCo',2.532284,1.110761), (1.851458), rtol0, 1376),
(('JUVI','GulfCo',23.216842,7.963616), (50.245199), rtol0, 1396),
(('JUVI','GulfCo',84.300817,13.137797), (452.257369), rtol0, 1431),
(('QUVI','GulfCo',0.944638,0.663236), (0.082804), rtol0, 2208),
(('QUVI','GulfCo',41.528161,10.673163), (225.816964), rtol0, 2228),
(('QUVI','GulfCo',86.038186,14.164601), (411.689073), rtol0, 2258),
(('QUVI','GulfCo',114.541944,15.648539), (166.799803), rtol0, 2297),
(('SAPA','GulfCo',0.000000,0.075017), (5.199441), rtol0, 2298),
(('SAPA','GulfCo',0.000000,6.170151), (5.755624), rtol0, 2318),
(('SAPA','GulfCo',0.000000,12.566891), (1.088516), rtol0, 2343),
(('FRUH','InlEmp',1.294176,0.311617), (0.376567), rtol0, 2602),
(('FRUH','InlEmp',46.614376,15.570709), (302.827557), rtol0, 2622),
(('FRUH','InlEmp',87.542997,22.777123), (395.904254), rtol0, 2652),
(('FRUH','InlEmp',118.037479,26.817686), (0.000000), rtol0, 2692),
(('LITU','InlEmp',1.977042,3.519398), (4.170676), rtol0, 3078),
(('LITU','InlEmp',30.903142,12.540529), (75.506863), rtol0, 3098),
(('LITU','InlEmp',54.853100,17.641602), (291.940231), rtol0, 3128),
(('LITU','InlEmp',83.056354,20.897982), (1239.673563), rtol0, 3143),
(('PHDA4','InlEmp',0.000000,0.265530), (8.247157), rtol0, 3314),
(('PHDA4','InlEmp',0.000000,7.130000), (6.681839), rtol0, 3334),
(('PHDA4','InlEmp',0.000000,18.605000), (4.380272), rtol0, 3364),
(('PHDA4','InlEmp',0.000000,20.547600), (1.941031), rtol0, 3374),
(('PIBR2','InlEmp',4.120980,3.112590), (2.158682), rtol0, 3375),
(('PIBR2','InlEmp',53.609388,11.875958), (133.254804), rtol0, 3395),
(('PIBR2','InlEmp',55.735456,11.964935), (0.000000), rtol0, 3400),
(('FRPE_M','InlVal',2.522745,1.988909), (4.446138), rtol0, 4585),
(('FRPE_M','InlVal',29.764679,9.862210), (86.089424), rtol0, 4605),
(('FRPE_M','InlVal',43.491826,11.765379), (0.000000), rtol0, 4633),
(('FRVE_G','InlVal',2.520593,2.000184), (0.634341), rtol0, 4634),
(('FRVE_G','InlVal',36.149469,10.867202), (89.340254), rtol0, 4654),
(('FRVE_G','InlVal',67.137307,19.037851), (154.361451), rtol0, 4684),
(('FRVE_G','InlVal',75.126318,21.144336), (2.494350), rtol0, 4709),
(('PHDA4','InlVal',0.000000,0.265530), (8.247157), rtol0, 5212),
(('PHDA4','InlVal',0.000000,7.130000), (6.681839), rtol0, 5232),
(('PHDA4','InlVal',0.000000,18.605000), (4.380272), rtol0, 5262),
(('PHDA4','InlVal',0.000000,20.547600), (1.941031), rtol0, 5272),
(('CHLI','InterW',4.297047,2.843370), (10.229447), rtol0, 5970),
(('CHLI','InterW',22.892089,5.519013), (31.557992), rtol0, 5990),
(('CHLI','InterW',41.487132,10.712466), (77.608463), rtol0, 6010),
(('EUMI2','InterW',2.558965,2.679927), (1.278820), rtol0, 6186),
(('EUMI2','InterW',39.256208,13.953052), (207.124501), rtol0, 6206),
(('EUMI2','InterW',85.127762,23.391038), (1006.107085), rtol0, 6231),
(('FRAM','InterW',2.442177,3.948046), (1.847648), rtol0, 6232),
(('FRAM','InterW',30.870640,9.490035), (143.214724), rtol0, 6252),
(('FRAM','InterW',75.757686,18.240544), (552.451253), rtol0, 6282),
(('FRAM','InterW',75.757686,18.240544), (0.000000), rtol0, 6292),
(('GLTR','InterW',2.716725,3.104259), (6.827235), rtol0, 6475),
(('GLTR','InterW',24.950490,7.898610), (85.083192), rtol0, 6495),
(('GLTR','InterW',58.301139,15.090138), (250.098073), rtol0, 6525),
(('GLTR','InterW',66.082957,16.768161), (293.277012), rtol0, 6532),
(('WARO','InterW',0.000000,0.760760), (16.169568), rtol0, 7501),
(('WARO','InterW',0.000000,13.224000), (8.984800), rtol0, 7521),
(('WARO','InterW',0.000000,25.200000), (3.955206), rtol0, 7551),
(('WARO','InterW',0.000000,27.971160), (0.434490), rtol0, 7572),
(('ACRU','LoMidW',1.176693,2.923985), (0.662206), rtol0, 7659),
(('ACRU','LoMidW',26.210135,10.723411), (58.527019), rtol0, 7679),
(('ACRU','LoMidW',56.230192,17.984690), (100.402117), rtol0, 7709),
(('ACRU','LoMidW',80.395785,22.172587), (31.718877), rtol0, 7759),
(('ACRU','LoMidW',81.348728,22.307436), (7.176055), rtol0, 7769),
(('MAGR','LoMidW',3.060798,1.605294), (0.824816), rtol0, 8811),
(('MAGR','LoMidW',27.941372,10.546027), (52.636178), rtol0, 8831),
(('MAGR','LoMidW',79.598063,18.737210), (301.086582), rtol0, 8861),
(('MAGR','LoMidW',83.653505,18.787590), (0.000000), rtol0, 8866),
(('PHDA4','LoMidW',0.000000,0.265530), (8.247157), rtol0, 9085),
(('PHDA4','LoMidW',0.000000,7.130000), (6.681839), rtol0, 9105),
(('PHDA4','LoMidW',0.000000,18.605000), (4.380272), rtol0, 9135),
(('PHDA4','LoMidW',0.000000,20.547600), (1.941031), rtol0, 9145),
(('QURU','LoMidW',1.501953,4.561136), (3.816464), rtol0, 9560),
(('QURU','LoMidW',30.762895,11.531834), (142.869346), rtol0, 9580),
(('QURU','LoMidW',76.964383,20.713367), (555.824934), rtol0, 9610),
(('QURU','LoMidW',130.866119,28.601013), (1212.000212), rtol0, 9645),
(('ULPU','LoMidW',3.767688,5.499016), (43.259867), rtol0, 9757),
(('ULPU','LoMidW',38.589456,13.764282), (164.096807), rtol0, 9777),
(('ULPU','LoMidW',79.570279,19.610818), (183.199689), rtol0, 9807),
(('ULPU','LoMidW',117.866775,21.285262), (37.604206), rtol0, 9857),
(('ULPU','LoMidW',122.683667,21.285262), (9.225591), rtol0, 9877),
(('ACRU','MidWst',4.121642,2.976393), (10.352405), rtol0, 10042),
(('ACRU','MidWst',26.811426,11.501642), (101.143547), rtol0, 10062),
(('ACRU','MidWst',63.030646,17.621169), (703.377788), rtol0, 10072),
(('QUNI','MidWst',4.519772,2.536725), (3.486013), rtol0, 10706),
(('QUNI','MidWst',37.731472,14.359711), (186.732045), rtol0, 10726),
(('QUNI','MidWst',93.440976,23.650993), (666.364226), rtol0, 10756),
(('QUNI','MidWst',112.170984,25.860324), (114.356145), rtol0, 10777),
(('QURU','MidWst',1.993741,3.397555), (1.224335), rtol0, 10817),
(('QURU','MidWst',31.465349,12.894021), (126.940576), rtol0, 10837),
(('QURU','MidWst',63.230390,17.075539), (222.928968), rtol0, 10867),
(('QURU','MidWst',68.493850,17.161840), (0.000000), rtol0, 10886),
(('FRAM','NMtnPr',2.842198,2.631455), (2.963298), rtol0, 11551),
(('FRAM','NMtnPr',28.030549,12.705958), (129.827179), rtol0, 11571),
(('FRAM','NMtnPr',72.381090,19.321112), (363.066277), rtol0, 11601),
(('FRAM','NMtnPr',80.307751,20.123623), (31.580645), rtol0, 11615),
(('MAGR','NMtnPr',3.060798,1.605294), (0.824816), rtol0, 12018),
(('MAGR','NMtnPr',27.941372,10.546027), (52.636178), rtol0, 12038),
(('MAGR','NMtnPr',83.653505,18.787590), (313.708659), rtol0, 12070),
(('PICO5','NMtnPr',2.611644,2.160485), (0.540854), rtol0, 12071),
(('PICO5','NMtnPr',32.059927,8.966780), (27.875389), rtol0, 12091),
(('PICO5','NMtnPr',43.455353,11.600571), (30.755621), rtol0, 12108),
(('ACRU','NoEast',2.641658,3.871285), (3.902201), rtol0, 13187),
(('ACRU','NoEast',21.975879,8.382957), (28.686743), rtol0, 13207),
(('ACRU','NoEast',37.087139,11.569658), (30.427511), rtol0, 13237),
(('ACRU','NoEast',72.771931,17.912548), (218.306680), rtol0, 13287),
(('ACRU','NoEast',105.198593,22.235602), (548.617092), rtol0, 13306),
(('FRPE','NoEast',2.417639,1.560735), (3.514247), rtol0, 13712),
(('FRPE','NoEast',24.765732,10.691435), (66.912730), rtol0, 13732),
(('FRPE','NoEast',44.606945,14.753367), (99.367167), rtol0, 13762),
(('FRPE','NoEast',106.307518,22.062210), (920.354560), rtol0, 13812),
(('FRPE','NoEast',123.452416,23.477341), (1287.018576), rtol0, 13819),
(('JUVI','NoEast',3.336559,1.261638), (3.839192), rtol0, 14137),
(('JUVI','NoEast',33.082409,12.612634), (94.996609), rtol0, 14157),
(('JUVI','NoEast',69.903054,17.906746), (168.707481), rtol0, 14187),
(('JUVI','NoEast',85.952514,23.962760), (188.646375), rtol0, 14204),
(('SAPA','NoEast',0.000000,0.113154), (5.809539), rtol0, 15279),
(('SAPA','NoEast',0.000000,6.145750), (1.769492), rtol0, 15299),
(('SAPA','NoEast',0.000000,7.800818), (0.882886), rtol0, 15321),
(('ULPA99','NoEast',2.771588,3.609792), (2.232251), rtol0, 15718),
(('ULPA99','NoEast',21.435929,9.534459), (74.558388), rtol0, 15738),
(('ULPA99','NoEast',48.791896,13.691404), (23.214591), rtol0, 15762),
(('LITU','NoCalC',2.841073,3.960871), (1.313752), rtol0, 16460),
(('LITU','NoCalC',20.714500,9.413979), (38.505412), rtol0, 16480),
(('LITU','NoCalC',47.524639,15.273803), (165.787605), rtol0, 16510),
(('LITU','NoCalC',84.165163,18.780197), (449.421010), rtol0, 16551),
(('PIRA','NoCalC',2.805513,1.453239), (0.503309), rtol0, 16905),
(('PIRA','NoCalC',34.869016,12.094076), (69.229876), rtol0, 16925),
(('PIRA','NoCalC',82.964270,21.215003), (272.121273), rtol0, 16955),
(('PIRA','NoCalC',115.027772,22.747530), (380.647179), rtol0, 16975),
(('PYCA','NoCalC',0.551853,0.858170), (0.078591), rtol0, 17104),
(('PYCA','NoCalC',23.294165,9.258778), (59.078466), rtol0, 17124),
(('PYCA','NoCalC',57.407633,12.435001), (168.873167), rtol0, 17154),
(('WARO','NoCalC',0.000000,0.620643), (13.928056), rtol0, 17566),
(('WARO','NoCalC',0.000000,14.796816), (10.800574), rtol0, 17586),
(('WARO','NoCalC',0.000000,28.492875), (3.754066), rtol0, 17616),
(('WARO','NoCalC',0.000000,30.526200), (0.031183), rtol0, 17637),
(('ACRU','PacfNW',1.324801,2.751411), (0.858857), rtol0, 17884),
(('ACRU','PacfNW',31.965046,12.423359), (99.298833), rtol0, 17904),
(('ACRU','PacfNW',80.344379,19.235423), (303.810091), rtol0, 17934),
(('ACRU','PacfNW',96.470824,27.546689), (378.682722), rtol0, 17944),
(('PSME','PacfNW',1.152304,0.703725), (4.185384), rtol0, 18778),
(('PSME','PacfNW',40.971466,19.106857), (237.350711), rtol0, 18798),
(('PSME','PacfNW',85.216325,29.363202), (414.774976), rtol0, 18828),
(('PSME','PacfNW',108.857273,30.478423), (9.461423), rtol0, 18871),
(('QUAG','PacfNW',1.557324,2.505330), (0.307790), rtol0, 18971),
(('QUAG','PacfNW',31.295493,9.434010), (89.991178), rtol0, 18991),
(('QUAG','PacfNW',75.902746,13.506925), (349.430642), rtol0, 19021),
(('QUAG','PacfNW',150.248168,20.462946), (1466.564971), rtol0, 19071),
(('QURU','PacfNW',1.987888,4.384578), (1.286306), rtol0, 19072),
(('QURU','PacfNW',42.037288,12.883643), (322.570195), rtol0, 19092),
(('QURU','PacfNW',97.309129,27.580379), (606.324714), rtol0, 19122),
(('QURU','PacfNW',105.867967,27.998097), (27.643920), rtol0, 19136),
(('TIAM','PacfNW',1.118585,2.501098), (1.464597), rtol0, 19137),
(('TIAM','PacfNW',33.719246,11.507367), (88.377983), rtol0, 19157),
(('TIAM','PacfNW',75.100736,20.480841), (116.509628), rtol0, 19187),
(('TIAM','PacfNW',84.852615,22.195065), (0.096345), rtol0, 19207),
(('WARO','PacfNW',0.000000,0.620643), (13.928056), rtol0, 19402),
(('WARO','PacfNW',0.000000,14.796816), (10.800574), rtol0, 19422),
(('WARO','PacfNW',0.000000,28.492875), (3.754066), rtol0, 19452),
(('WARO','PacfNW',0.000000,30.526200), (0.031183), rtol0, 19473),
(('ACRU','Piedmt',4.187715,4.000092), (10.719887), rtol0, 19474),
(('ACRU','Piedmt',35.334337,13.311435), (126.430819), rtol0, 19494),
(('ACRU','Piedmt',103.038301,26.290365), (672.618226), rtol0, 19524),
(('ACRU','Piedmt',122.459135,26.290365), (888.665258), rtol0, 19531),
(('COFL','Piedmt',1.442711,2.155595), (1.008595), rtol0, 19686),
(('COFL','Piedmt',33.694364,7.817193), (122.842862), rtol0, 19706),
(('COFL','Piedmt',51.611949,8.814804), (201.483151), rtol0, 19716),
(('QUAL','Piedmt',1.329137,1.881604), (0.279944), rtol0, 20320),
(('QUAL','Piedmt',35.843757,17.999803), (229.926664), rtol0, 20340),
(('QUAL','Piedmt',90.340526,32.214163), (938.387055), rtol0, 20370),
(('QUAL','Piedmt',123.038587,34.169798), (1238.060164), rtol0, 20388),
(('QURU','Piedmt',3.869682,5.249751), (7.268398), rtol0, 20533),
(('QURU','Piedmt',38.642981,16.991875), (225.726746), rtol0, 20553),
(('QURU','Piedmt',96.018925,30.225512), (867.391034), rtol0, 20586),
(('WAFI','Piedmt',0.000000,0.365377), (9.844451), rtol0, 20670),
(('WAFI','Piedmt',0.000000,7.001040), (5.304606), rtol0, 20690),
(('WAFI','Piedmt',0.000000,15.618750), (3.804276), rtol0, 20720),
(('WAFI','Piedmt',0.000000,21.311220), (0.472723), rtol0, 20761),
(('FIMI','SoCalC',2.503877,1.491101), (0.946355), rtol0, 21215),
(('FIMI','SoCalC',38.127507,7.781696), (25.282286), rtol0, 21235),
(('FIMI','SoCalC',79.945102,11.803796), (336.903104), rtol0, 21266),
(('JAMI','SoCalC',2.677914,3.216587), (1.507687), rtol0, 21267),
(('JAMI','SoCalC',18.312622,5.740785), (14.113702), rtol0, 21287),
(('JAMI','SoCalC',41.764684,9.527081), (52.555434), rtol0, 21317),
(('JAMI','SoCalC',61.308069,12.682328), (98.873061), rtol0, 21342),
(('MEEX','SoCalC',2.522726,1.242857), (2.424049), rtol0, 21503),
(('MEEX','SoCalC',25.235997,7.526786), (16.255473), rtol0, 21523),
(('MEEX','SoCalC',69.559930,12.464845), (146.333945), rtol0, 21553),
(('MEEX','SoCalC',85.159704,13.612529), (225.423887), rtol0, 21558),
(('PRCA','SoCalC',2.526682,1.992632), (2.500761), rtol0, 22096),
(('PRCA','SoCalC',22.774535,5.825533), (24.973105), rtol0, 22116),
(('PRCA','SoCalC',30.238718,6.442458), (3.477767), rtol0, 22136),
(('WARO','SoCalC',0.000000,0.620643), (13.928056), rtol0, 22236),
(('WARO','SoCalC',0.000000,14.796816), (10.800574), rtol0, 22256),
(('WARO','SoCalC',0.000000,28.492875), (3.754066), rtol0, 22286),
(('WARO','SoCalC',0.000000,30.526200), (0.031183), rtol0, 22307),
(('OLEU','SWDsrt',2.525279,1.072480), (2.069195), rtol0, 22799),
(('OLEU','SWDsrt',28.659578,6.768037), (72.722031), rtol0, 22819),
(('OLEU','SWDsrt',55.541297,9.372113), (96.492207), rtol0, 22849),
(('OLEU','SWDsrt',68.386759,10.280516), (0.156771), rtol0, 22889),
(('PICH','SWDsrt',2.547395,2.675224), (1.041186), rtol0, 23120),
(('PICH','SWDsrt',22.940852,7.424473), (40.088135), rtol0, 23140),
(('PICH','SWDsrt',53.531037,12.316011), (174.316778), rtol0, 23170),
(('PICH','SWDsrt',63.727765,13.351234), (225.020794), rtol0, 23180),
(('PRCH','SWDsrt',2.522919,1.532896), (3.822313), rtol0, 23332),
(('PRCH','SWDsrt',36.706832,10.169386), (144.708418), rtol0, 23352),
(('PRCH','SWDsrt',70.890744,13.938985), (292.306720), rtol0, 23372),
(('ACSA2','TpIntW',3.577912,3.856246), (22.815230), rtol0, 23855),
(('ACSA2','TpIntW',22.394933,9.245268), (64.199803), rtol0, 23875),
(('ACSA2','TpIntW',56.404893,18.985408), (169.537786), rtol0, 23905),
(('ACSA2','TpIntW',76.424408,24.718813), (0.401655), rtol0, 23939),
(('FRAM','TpIntW',2.119924,3.999206), (1.438808), rtol0, 24127),
(('FRAM','TpIntW',33.232541,12.418070), (159.913302), rtol0, 24147),
(('FRAM','TpIntW',60.528025,18.704863), (153.457016), rtol0, 24177),
(('FRAM','TpIntW',105.578938,26.834033), (1109.814947), rtol0, 24225),
(('LIST','TpIntW',2.800413,1.583472), (0.896847), rtol0, 24609),
(('LIST','TpIntW',26.055290,12.923731), (42.050485), rtol0, 24629),
(('LIST','TpIntW',53.832476,20.302874), (80.556803), rtol0, 24659),
(('LIST','TpIntW',68.890828,23.283308), (28.710512), rtol0, 24694),
(('CAEQ','Tropic',2.440925,3.133434), (2.876249), rtol0, 25648),
(('CAEQ','Tropic',22.241471,9.556731), (48.486001), rtol0, 25668),
(('CAEQ','Tropic',51.942291,17.026762), (166.771568), rtol0, 25698),
(('CAEQ','Tropic',101.443657,23.703705), (342.269507), rtol0, 25748),
(('CAEQ','Tropic',116.294067,24.299593), (362.278063), rtol0, 25763),
(('CONU','Tropic',0.000000,1.569590), (29.108774), rtol0, 26045),
(('CONU','Tropic',0.000000,12.824272), (7.817396), rtol0, 26065),
(('CONU','Tropic',0.000000,23.858777), (4.075584), rtol0, 26095),
(('CONU','Tropic',0.000000,25.015651), (3.451949), rtol0, 26100),
(('MEQU','Tropic',2.356344,1.987466), (2.113403), rtol0, 26615),
(('MEQU','Tropic',31.018065,7.797275), (34.082418), rtol0, 26635),
(('MEQU','Tropic',81.176078,10.777461), (91.386964), rtol0, 26670),
(('PIBR2','Tropic',4.120980,3.112590), (2.158682), rtol0, 26732),
(('PIBR2','Tropic',53.609388,11.875958), (133.254804), rtol0, 26752),
(('PIBR2','Tropic',55.735456,11.964935), (0.000000), rtol0, 26757),
(('PIRA','Tropic',2.805513,1.453239), (0.503309), rtol0, 26796),
(('PIRA','Tropic',34.869016,12.094076), (69.229876), rtol0, 26816),
(('PIRA','Tropic',82.964270,21.215003), (272.121273), rtol0, 26846),
(('PIRA','Tropic',115.027772,22.747530), (380.647179), rtol0, 26866),
])
def test_growth_calc(input, expected, rtol, dataid):
    (speccode, region, dbh, ht) = input
    assert_allclose(growth.biomasstoCO2(growth.biomass_diff2(growth.dbconn, speccode, region, dbh, ht, lower_bound=0, upper_bound=100, rounded=False)[0]), expected, rtol=rtol)
#    assert_allclose(biomass.biomass_calc(biomass.dbconn, speccode, region, dbh, ht, useminmax=True, negcorrect=True), expected, rtol=rtol)

"""   
